## ros::spin()

### 简单介绍

在ROS(机器人操作系统)中,`ros::spin()`函数的作用是进入循环等待回调的执行。

`ros::spin()`会检查节点是否还在运行,并处理待处理的事件和回调函数。 它通常在ROS程序的main函数中被调用,用来让节点进入待命状态。

`ros::spin()`具体做了以下几件事:

- 1. 调用`ros::getGlobalCallbackQueue()->callAvailable()`来执行pending的回调函数。
- 2. 如果程序未设置退出,则 sleep 一段时间(1毫秒)。
- 3. 重复上述操作,持续处理回调函数。
- 4. 如果检测到需要退出程序,则退出spin循环。

所以在编写ROS节点时,通过调用`ros::spin()`可以让节点不断处理收到的ROS事件和消息,执行相关的回调函数,实现节点的持续运行。

通常在main函数末尾添加 `ros::spin();` 来进入循环等待并处理回调执行。

总之,ros::spin()对于编写ROS节点非常重要,它让节点能够一直运行并及时响应ROS事件和消息。

### 使用情况

ros::spin()函数主要适用于以下几种情况:

1. 在ROS节点的main函数中调用,让节点进入循环等待回调执行的状态。这是ros::spin()的最典型用法。
2. 当节点需要持续运行、接收并处理ROS中的事件和消息时,通过spin进入循环非常有效。
3. 在编写ROS的**subscriber**节点时,调用spin函数可以让节点随时响应topic消息,执行订阅的回调函数。
4. 在编写ROS的**service**节点时,调用spin函数可以确保服务请求得到及时响应。
5. 当节点作为server提供服务时,spin函数让服务器节点可以持续处理服务请求。
6. 在使用ROS的异步调用机制(callback queue)时,spin函数可以帮助及时执行异步回调。
7. 在测试ros节点时,可以通过spin函数持续处理节点回调,而不是简单退出。
8. 想要节点在后台持续运行,而不在前台阻塞时,spin函数非常适用。

总之,spin函数适用于希望ROS节点能够长时间运行、持续接收并处理消息和事件的情况。它可以避免节点直接退出,是ROS程序员必须掌握使用的函数。